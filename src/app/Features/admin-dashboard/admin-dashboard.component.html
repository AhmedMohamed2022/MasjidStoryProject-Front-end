<div class="admin-dashboard">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-text">
        <h1>{{ 'ADMIN_DASHBOARD.TITLE' | translate }}</h1>
        <p>{{ 'ADMIN_DASHBOARD.SUBTITLE' | translate }}</p>
      </div>
      <div class="header-icon">
        <mat-icon>admin_panel_settings</mat-icon>
      </div>
    </div>
  </div>

  <!-- Dashboard Statistics -->
  <div class="dashboard-stats" *ngIf="!pendingLoading && !allStoriesLoading">
    <div class="stat-card">
      <div class="stat-icon pending">
        <!-- Hourglass SVG -->
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <ellipse cx="16" cy="8" rx="7" ry="3" fill="#bfa046" fill-opacity="0.18" />
          <path
            d="M9 8c0 1.657 3.134 3 7 3s7-1.343 7-3m-14 0V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v2m-14 0c0 1.657 3.134 3 7 3s7-1.343 7-3"
            stroke="#bfa046" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path
            d="M9 24c0-1.657 3.134-3 7-3s7 1.343 7 3m-14 0v2a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-2m-14 0c0-1.657 3.134-3 7-3s7 1.343 7 3"
            stroke="#bfa046" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M16 11v10" stroke="#bfa046" stroke-width="2" stroke-linecap="round" />
          <ellipse cx="16" cy="24" rx="7" ry="3" fill="#bfa046" fill-opacity="0.18" />
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-number animated-number"><span #animatedNumber
            [attr.data-target]="pendingStories.length"></span></div>
        <div class="stat-label">{{ 'ADMIN_DASHBOARD.PENDING_STORIES' | translate }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon published">
        <!-- Book SVG -->
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <rect x="6" y="6" width="20" height="20" rx="4" fill="#1b5e20" fill-opacity="0.13" />
          <rect x="8" y="8" width="16" height="16" rx="2" stroke="#1b5e20" stroke-width="2" />
          <path d="M12 12h8M12 16h8M12 20h4" stroke="#1b5e20" stroke-width="2" stroke-linecap="round" />
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-number animated-number"><span #animatedNumber [attr.data-target]="allStories.length"></span>
        </div>
        <div class="stat-label">{{ 'ADMIN_DASHBOARD.PUBLISHED_STORIES' | translate }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon masjids">
        <!-- Mosque SVG -->
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <ellipse cx="16" cy="24" rx="7" ry="3" fill="#388e3c" fill-opacity="0.13" />
          <path d="M16 8l-4 8h8l-4-8z" fill="#388e3c" fill-opacity="0.18" />
          <path d="M9 24v-4a7 7 0 0 1 14 0v4" stroke="#388e3c" stroke-width="2" stroke-linecap="round" />
          <path d="M16 8l-4 8h8l-4-8z" stroke="#388e3c" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-number animated-number"><span #animatedNumber [attr.data-target]="masjids.length"></span></div>
        <div class="stat-label">{{ 'ADMIN_DASHBOARD.TOTAL_MASJIDS' | translate }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon events">
        <!-- Calendar SVG -->
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <rect x="6" y="10" width="20" height="14" rx="4" fill="#bfa046" fill-opacity="0.13" />
          <rect x="8" y="12" width="16" height="10" rx="2" stroke="#bfa046" stroke-width="2" />
          <rect x="12" y="16" width="4" height="4" rx="1" fill="#bfa046" />
          <rect x="16" y="16" width="4" height="4" rx="1" fill="#bfa046" />
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-number animated-number"><span #animatedNumber [attr.data-target]="events.length"></span></div>
        <div class="stat-label">{{ 'ADMIN_DASHBOARD.TOTAL_EVENTS' | translate }}</div>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="dashboard-container">
    <mat-tab-group (selectedTabChange)="onTabChange($event.index)" [selectedIndex]="selectedTab" class="dashboard-tabs">
      <mat-tab *ngFor="let tab of tabs; let i = index" [label]="tab.label | translate">

        <!-- Pending Stories Tab -->
        <div *ngIf="i === 0" class="tab-content">
          <div class="content-header">
            <div class="header-info">
              <h2>{{ 'ADMIN_DASHBOARD.PENDING_STORIES_HEADER' | translate }}</h2>
              <p>{{ 'ADMIN_DASHBOARD.PENDING_STORIES_DESC' | translate }}</p>
            </div>
            <div class="header-stats" *ngIf="!pendingLoading && !pendingError">
              <div class="stat-item">
                <span class="stat-number">{{ pendingStories.length }}</span>
                <span class="stat-label">{{ 'ADMIN_DASHBOARD.PENDING' | translate }}</span>
              </div>
            </div>
          </div>

          <!-- Bulk Operations -->
          <div *ngIf="!pendingLoading && !pendingError && pendingStories.length > 0" class="bulk-operations">
            <div class="bulk-header">
              <mat-checkbox [checked]="allSelected" [indeterminate]="someSelected" (change)="toggleAllStories($event)">
                {{ 'ADMIN_DASHBOARD.SELECT_ALL' | translate }}
              </mat-checkbox>
              <div class="bulk-actions" *ngIf="selectedStories.length > 0">
                <button mat-raised-button color="primary" (click)="bulkApproveStories()">
                  <mat-icon>check_circle</mat-icon>
                  {{ 'ADMIN_DASHBOARD.APPROVE_SELECTED' | translate }} ({{ selectedStories.length }})
                </button>
                <button mat-raised-button color="warn" (click)="bulkDeleteStories()">
                  <mat-icon>delete</mat-icon>
                  {{ 'ADMIN_DASHBOARD.DELETE_SELECTED' | translate }} ({{ selectedStories.length }})
                </button>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="pendingLoading" class="loading-state">
            <div class="loading-content">
              <mat-spinner diameter="40"></mat-spinner>
              <p>{{ 'ADMIN_DASHBOARD.LOADING_PENDING_STORIES' | translate }}</p>
            </div>
          </div>

          <!-- Error State -->
          <div *ngIf="pendingError" class="error-state">
            <div class="error-content">
              <mat-icon>error_outline</mat-icon>
              <p>{{ pendingError }}</p>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="!pendingLoading && !pendingError && pendingStories.length === 0" class="empty-state">
            <div class="empty-content">
              <mat-icon>inbox</mat-icon>
              <h3>{{ 'ADMIN_DASHBOARD.NO_PENDING_STORIES' | translate }}</h3>
              <p>{{ 'ADMIN_DASHBOARD.NO_PENDING_STORIES_DESC' | translate }}</p>
            </div>
          </div>

          <!-- Stories List -->
          <div *ngIf="!pendingLoading && !pendingError && pendingStories.length > 0" class="stories-grid admin-grid">
            <div *ngFor="let story of pendingStories" class="story-card admin-card">
              <div class="card-header">
                <div class="card-header-left">
                  <mat-checkbox [checked]="isStorySelected(story.id)" (change)="toggleStorySelection(story.id, $event)">
                  </mat-checkbox>
                  <h3>{{ story.localizedTitle }}</h3>
                </div>
                <div class="card-badge pending">{{ 'ADMIN_DASHBOARD.PENDING_REVIEW' | translate }}</div>
              </div>
              <div class="card-body">
                <div class="story-meta meta-grid">
                  <div class="meta-item">
                    <mat-icon>person</mat-icon>
                    <span>{{ story.authorFullName }}</span>
                  </div>
                  <div class="meta-item">
                    <mat-icon>mosque</mat-icon>
                    <span>{{ story.masjidName }}</span>
                  </div>
                  <div class="meta-item">
                    <mat-icon>schedule</mat-icon>
                    <span>{{ story.datePublished | date:'mediumDate' }}</span>
                  </div>
                </div>

                <!-- Change History Section -->
                <div class="change-history" *ngIf="story.changeReason">
                  <div class="change-header">
                    <mat-icon class="change-icon">history</mat-icon>
                    <span class="change-title">{{ 'ADMIN_DASHBOARD.CHANGES_REQUIRING_REVIEW' | translate }}</span>
                  </div>
                  <div class="change-reasons">
                    <span class="change-reason" *ngFor="let reason of getChangeReasons(story.changeReason)">
                      {{ reason }}
                    </span>
                  </div>
                </div>

                <div class="story-content content-text">
                  <p>{{ story.localizedContent | slice:0:200 }}...</p>
                </div>

                <!-- Story Images Preview -->
                <div class="story-images" *ngIf="story.imageUrls && story.imageUrls.length > 0">
                  <div class="images-preview">
                    <img *ngFor="let imageUrl of story.imageUrls.slice(0, 3)" [src]="getFullImageUrl(imageUrl)"
                      [alt]="'Story image'" class="story-thumbnail">
                    <div *ngIf="story.imageUrls.length > 3" class="more-images">
                      +{{ story.imageUrls.length - 3 }} more
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-actions">
                <button mat-raised-button color="primary" class="btn-approve" (click)="approveStory(story)">
                  <mat-icon>check_circle</mat-icon>
                  {{ 'ADMIN_DASHBOARD.APPROVE' | translate }}
                </button>
                <button mat-raised-button color="warn" class="btn-delete" (click)="deleteStory(story)">
                  <mat-icon>delete</mat-icon>
                  {{ 'ADMIN_DASHBOARD.DELETE' | translate }}
                </button>
                <button mat-raised-button color="accent" class="btn-view" (click)="viewStory(story)">
                  <mat-icon>visibility</mat-icon>
                  {{ 'ADMIN_DASHBOARD.VIEW' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- All Stories Tab -->
        <div *ngIf="i === 1" class="tab-content">
          <div class="content-header">
            <div class="header-info">
              <h2>{{ 'ADMIN_DASHBOARD.ALL_STORIES_HEADER' | translate }}</h2>
              <p>{{ 'ADMIN_DASHBOARD.ALL_STORIES_DESC' | translate }}</p>
            </div>
            <div class="header-stats" *ngIf="!allStoriesLoading && !allStoriesError">
              <div class="stat-item">
                <span class="stat-number">{{ allStories.length }}</span>
                <span class="stat-label">{{ 'ADMIN_DASHBOARD.TOTAL_STORIES' | translate }}</span>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="allStoriesLoading" class="loading-state">
            <div class="loading-content">
              <mat-spinner diameter="40"></mat-spinner>
              <p>{{ 'ADMIN_DASHBOARD.LOADING_ALL_STORIES' | translate }}</p>
            </div>
          </div>

          <!-- Error State -->
          <div *ngIf="allStoriesError" class="error-state">
            <div class="error-content">
              <mat-icon>error_outline</mat-icon>
              <p>{{ allStoriesError }}</p>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="!allStoriesLoading && !allStoriesError && allStories.length === 0" class="empty-state">
            <div class="empty-content">
              <mat-icon>article</mat-icon>
              <h3>{{ 'ADMIN_DASHBOARD.NO_STORIES_FOUND' | translate }}</h3>
              <p>{{ 'ADMIN_DASHBOARD.NO_STORIES_FOUND_DESC' | translate }}</p>
            </div>
          </div>

          <!-- Stories List -->
          <div *ngIf="!allStoriesLoading && !allStoriesError && allStories.length > 0" class="stories-grid admin-grid">
            <div *ngFor="let story of allStories" class="story-card admin-card">
              <div class="card-header">
                <h3>{{ story.localizedTitle }}</h3>
                <div class="card-badge published">{{ 'ADMIN_DASHBOARD.PUBLISHED' | translate }}</div>
              </div>
              <div class="card-body">
                <div class="story-meta meta-grid">
                  <div class="meta-item">
                    <mat-icon>person</mat-icon>
                    <span>{{ story.authorFullName }}</span>
                  </div>
                  <div class="meta-item">
                    <mat-icon>mosque</mat-icon>
                    <span>{{ story.masjidName }}</span>
                  </div>
                  <div class="meta-item">
                    <mat-icon>schedule</mat-icon>
                    <span>{{ story.datePublished | date:'mediumDate' }}</span>
                  </div>
                  <div class="meta-item">
                    <mat-icon>favorite</mat-icon>
                    <span>{{ story.likeCount }} likes</span>
                  </div>
                </div>
                <div class="story-content content-text">
                  <p>{{ story.localizedContent | slice:0:200 }}...</p>
                </div>
              </div>
              <div class="card-actions">
                <button mat-raised-button color="warn" class="btn-delete" (click)="deleteStory(story)">
                  <mat-icon>delete</mat-icon>
                  {{ 'ADMIN_DASHBOARD.DELETE' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Masjids Tab -->
        <div *ngIf="i === 2" class="tab-content">
          <div class="content-header">
            <div class="header-info">
              <h2>{{ 'ADMIN_DASHBOARD.MASJIDS_HEADER' | translate }}</h2>
              <p>{{ 'ADMIN_DASHBOARD.MASJIDS_DESC' | translate }}</p>
            </div>
            <div class="header-actions">
              <button mat-raised-button color="primary" class="btn-create" (click)="showCreateMasjidForm()">
                <mat-icon>add</mat-icon>
                {{ 'ADMIN_DASHBOARD.CREATE_NEW_MASJID' | translate }}
              </button>
            </div>
          </div>

          <!-- Create/Edit Masjid Form -->
          <div *ngIf="showCreateForm || showEditForm" class="form-container">
            <div class="form-card">
              <div class="form-header">
                <h3>{{ showCreateForm ? ('ADMIN_DASHBOARD.CREATE_NEW_MASJID' | translate) :
                  ('ADMIN_DASHBOARD.EDIT_MASJID' | translate) }}</h3>
                <button mat-icon-button class="btn-close" (click)="cancelForm()">
                  <mat-icon>close</mat-icon>
                </button>
              </div>

              <form [formGroup]="masjidForm" (ngSubmit)="onSubmit()" class="masjid-form form-content">
                <div formArrayName="contents" class="form-grid">
                  <div *ngFor="let content of contentsArray.controls; let i = index" [formGroupName]="i"
                    class="lang-section">
                    <h4 style="margin-bottom: 0.5em;">
                      {{ i === 0 ? ('ADMIN_DASHBOARD.LANGUAGE_ENGLISH' | translate) : ('ADMIN_DASHBOARD.LANGUAGE_ARABIC'
                      | translate) }}
                    </h4>
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>{{ 'ADMIN_DASHBOARD.SHORT_NAME_LABEL' | translate }} {{ i === 0 ? '(EN)' : '(AR)'
                        }}</mat-label>
                      <input matInput formControlName="name"
                        [placeholder]="'ADMIN_DASHBOARD.MASJID_NAME_PLACEHOLDER' | translate">
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>{{ 'ADMIN_DASHBOARD.DESCRIPTION_LABEL' | translate }} {{ i === 0 ? '(EN)' : '(AR)'
                        }}</mat-label>
                      <textarea matInput formControlName="description"
                        [placeholder]="'ADMIN_DASHBOARD.DESCRIPTION_PLACEHOLDER' | translate" rows="3"></textarea>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="w-100 mb-2">
                      <mat-label>{{ languages[i].name }} Address</mat-label>
                      <input matInput formControlName="address" required
                        [placeholder]="'ADMIN_DASHBOARD.ADDRESS_PLACEHOLDER' | translate">
                      <mat-error *ngIf="content.get('address')?.hasError('required')">
                        {{ 'ADMIN_DASHBOARD.ADDRESS_LABEL' | translate }} is required
                      </mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div
                  *ngIf="masjidForm.get('contents')?.hasError('atLeastOneName') && masjidForm.get('contents')?.touched">
                  <mat-error>{{ 'At least one language name is required.' | translate }}</mat-error>
                </div>
                <!-- Arch Style dropdown -->
                <mat-form-field appearance="outline" class="w-100 mb-2">
                  <mat-label>{{ 'ADMIN_DASHBOARD.ARCHITECTURAL_STYLE_LABEL' | translate }}</mat-label>
                  <mat-select formControlName="archStyle">
                    <mat-option *ngFor="let style of archStyleOptions" [value]="style.key">
                      {{ style.label | translate }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ADMIN_DASHBOARD.YEAR_LABEL' | translate }}</mat-label>
                  <input matInput type="number" formControlName="yearOfEstablishment"
                    [placeholder]="'ADMIN_DASHBOARD.YEAR_PLACEHOLDER' | translate">
                </mat-form-field>
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ADMIN_DASHBOARD.COUNTRY_LABEL' | translate }}</mat-label>
                  <mat-select formControlName="countryId" (selectionChange)="onCountryChange()">
                    <mat-option *ngFor="let country of countries" [value]="country.id">
                      {{ country.name }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="masjidForm.get('countryId')?.hasError('required')">
                    {{ 'ADMIN_DASHBOARD.COUNTRY_REQUIRED' | translate }}
                  </mat-error>
                </mat-form-field>
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ADMIN_DASHBOARD.CITY_LABEL' | translate }}</mat-label>
                  <mat-select formControlName="cityId" [disabled]="!cities.length">
                    <mat-option *ngFor="let city of cities" [value]="city.id">
                      {{ city.name }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="masjidForm.get('cityId')?.hasError('required')">
                    {{ 'ADMIN_DASHBOARD.CITY_REQUIRED' | translate }}
                  </mat-error>
                </mat-form-field>

                <!-- Map Picker for Location - Full Width -->
                <div class="map-section">
                  <h4>{{ 'ADMIN_DASHBOARD.LOCATION_HEADER' | translate }}</h4>
                  <p class="map-description">{{ 'ADMIN_DASHBOARD.LOCATION_DESC' | translate }}</p>
                  <div class="map-wrapper">
                    <app-map-picker [latitude]="masjidForm.get('latitude')?.value || 30.0444"
                      [longitude]="masjidForm.get('longitude')?.value || 31.2357" height="600px" width="100%"
                      (locationSelected)="onLocationSelected($event)">
                    </app-map-picker>
                  </div>
                </div>

                <!-- Media Upload -->
                <div class="media-section">
                  <div class="file-upload">
                    <label for="mediaFiles">{{ 'ADMIN_DASHBOARD.UPLOAD_MEDIA_LABEL' | translate }}</label>
                    <input type="file" id="mediaFiles" multiple accept="image/*" (change)="onFileSelect($event)">
                    <p class="file-info">{{ 'ADMIN_DASHBOARD.SELECTED_FILES' | translate }} {{ selectedFiles.length }}
                    </p>
                  </div>
                </div>

                <!-- Existing Media (for edit mode) -->
                <div
                  *ngIf="showEditForm && editingMasjid && editingMasjid.mediaItems && editingMasjid.mediaItems.length > 0"
                  class="existing-media">
                  <h4>{{ 'ADMIN_DASHBOARD.EXISTING_MEDIA_HEADER' | translate }}</h4>
                  <div class="media-grid">
                    <div *ngFor="let media of editingMasjid.mediaItems" class="media-item">
                      <img [src]="getFullImageUrl(media.fileUrl)" [alt]="media.fileName" class="media-preview">
                      <div class="media-actions">
                        <mat-checkbox (change)="onMediaDeleteSelect(media.id, $event)">
                          {{ 'ADMIN_DASHBOARD.DELETE' | translate }}
                        </mat-checkbox>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="button" mat-button class="btn-cancel" (click)="cancelForm()">{{ 'ADMIN_DASHBOARD.CANCEL'
                    | translate }}</button>
                  <button type="submit" mat-raised-button color="primary" class="btn-submit"
                    [disabled]="!masjidForm.valid || isSubmitting">
                    <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
                    {{ showCreateForm ? ('ADMIN_DASHBOARD.CREATE_MASJID' | translate) : ('ADMIN_DASHBOARD.UPDATE_MASJID'
                    | translate) }}
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Masjids List -->
          <div *ngIf="!showCreateForm && !showEditForm">
            <!-- Loading State -->
            <div *ngIf="masjidsLoading" class="loading-state">
              <div class="loading-content">
                <mat-spinner diameter="40"></mat-spinner>
                <p>{{ 'ADMIN_DASHBOARD.LOADING_MASJIDS' | translate }}</p>
              </div>
            </div>

            <!-- Error State -->
            <div *ngIf="masjidsError" class="error-state">
              <div class="error-content">
                <mat-icon>error_outline</mat-icon>
                <p>{{ masjidsError }}</p>
              </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="!masjidsLoading && !masjidsError && masjids.length === 0" class="empty-state">
              <div class="empty-content">
                <mat-icon>mosque</mat-icon>
                <h3>{{ 'ADMIN_DASHBOARD.NO_MASJIDS_FOUND' | translate }}</h3>
                <p>{{ 'ADMIN_DASHBOARD.NO_MASJIDS_FOUND_DESC' | translate }}</p>
              </div>
            </div>

            <!-- Masjids List -->
            <div *ngIf="!masjidsLoading && !masjidsError && masjids.length > 0" class="masjids-grid admin-grid">
              <div *ngFor="let masjid of masjids" class="masjid-card admin-card">
                <div class="card-header">
                  <h3>{{ masjid.localizedName }}</h3>
                  <div class="card-badge masjid">{{ 'ADMIN_DASHBOARD.MASJID' | translate }}</div>
                </div>
                <div class="card-body">
                  <div class="masjid-meta meta-grid">
                    <div class="meta-item" *ngIf="masjid.localizedAddress">
                      <mat-icon>home</mat-icon>
                      <span>{{ masjid.localizedAddress }}</span>
                    </div>
                    <div class="meta-item">
                      <mat-icon>location_city</mat-icon>
                      <span>{{ masjid.cityName }}, {{ masjid.countryName }}</span>
                    </div>
                    <div class="meta-item" *ngIf="masjid.archStyle">
                      <mat-icon>architecture</mat-icon>
                      <span>{{ ('ARCH_STYLE.' + masjid.archStyle) | translate }}</span>
                    </div>
                    <div class="meta-item" *ngIf="masjid.yearOfEstablishment">
                      <mat-icon>calendar_today</mat-icon>
                      <span>{{ 'ADMIN_DASHBOARD.EST' | translate }} {{ masjid.yearOfEstablishment }}</span>
                    </div>
                  </div>
                </div>
                <div class="card-actions">
                  <button mat-raised-button color="primary" class="btn-edit" (click)="showEditMasjidForm(masjid)">
                    <mat-icon>edit</mat-icon>
                    {{ 'ADMIN_DASHBOARD.EDIT' | translate }}
                  </button>
                  <button mat-raised-button color="warn" class="btn-delete" (click)="deleteMasjid(masjid)">
                    <mat-icon>delete</mat-icon>
                    {{ 'ADMIN_DASHBOARD.DELETE' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Events Tab -->
        <div *ngIf="i === 3" class="tab-content">
          <div class="content-header">
            <div class="header-info">
              <h2>{{ 'ADMIN_DASHBOARD.EVENTS_HEADER' | translate }}</h2>
              <p>{{ 'ADMIN_DASHBOARD.EVENTS_DESC' | translate }}</p>
            </div>
            <div class="header-actions">
              <button mat-raised-button color="primary" class="btn-create" (click)="openCreateEventForm()">
                <mat-icon>add</mat-icon>
                {{ 'ADMIN_DASHBOARD.CREATE_EVENT' | translate }}
              </button>
            </div>
          </div>

          <!-- Create/Edit Event Form -->
          <div *ngIf="showCreateEventForm || showEditEventForm" class="form-container">
            <div class="form-card">
              <div class="form-header">
                <h3>{{ showCreateEventForm ? ('ADMIN_DASHBOARD.CREATE_EVENT' | translate) :
                  ('ADMIN_DASHBOARD.EDIT_EVENT' | translate) }}</h3>
                <button mat-icon-button class="btn-close" (click)="cancelEventForm()">
                  <mat-icon>close</mat-icon>
                </button>
              </div>

              <form [formGroup]="eventForm" (ngSubmit)="onSubmitEvent()" class="event-form form-content">
                <!-- Multilingual Title/Description Fields -->
                <div formArrayName="contents">
                  <div *ngFor="let content of eventContents.controls; let i = index" [formGroupName]="i" class="mb-4">
                    <h5>{{ languages[i].name }}</h5>
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>{{ 'ADMIN_DASHBOARD.EVENT_TITLE_LABEL' | translate }} ({{
                        languages[i].code.toUpperCase() }}) *</mat-label>
                      <input matInput formControlName="title" maxlength="200" required />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>{{ 'ADMIN_DASHBOARD.EVENT_DESCRIPTION_LABEL' | translate }} ({{
                        languages[i].code.toUpperCase() }}) *</mat-label>
                      <textarea matInput formControlName="description" rows="3" maxlength="1000" required></textarea>
                      <mat-hint align="end">{{ content.get('description')?.value?.length || 0 }}/1000</mat-hint>
                    </mat-form-field>
                  </div>
                </div>

                <!-- Event Date Field -->
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ 'ADMIN_DASHBOARD.EVENT_DATE_LABEL' | translate }}</mat-label>
                  <input matInput type="datetime-local" formControlName="eventDate" required />
                  <mat-error *ngIf="eventForm.get('eventDate')?.hasError('required')">
                    {{ 'ADMIN_DASHBOARD.EVENT_DATE_REQUIRED' | translate }}
                  </mat-error>
                </mat-form-field>

                <!-- Masjid Selection -->
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ 'ADMIN_DASHBOARD.EVENT_MASJID_LABEL' | translate }}</mat-label>
                  <mat-select formControlName="masjidId">
                    <mat-option [value]="null">{{ 'FORM.GENERAL_EVENT' | translate }}</mat-option>
                    <mat-option *ngFor="let masjid of masjids" [value]="masjid.id">
                      {{ getMasjidName(masjid) }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <div class="form-actions">
                  <button type="button" mat-button class="btn-cancel" (click)="cancelEventForm()">{{
                    'ADMIN_DASHBOARD.CANCEL' | translate }}</button>
                  <button type="submit" mat-raised-button color="primary" class="btn-submit"
                    [disabled]="!eventForm.valid || isSubmitting">
                    <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
                    {{ showCreateEventForm ? ('ADMIN_DASHBOARD.CREATE_EVENT' | translate) :
                    ('ADMIN_DASHBOARD.UPDATE_EVENT' | translate) }}
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Events List -->
          <div *ngIf="!showCreateEventForm && !showEditEventForm">
            <!-- Loading State -->
            <div *ngIf="eventsLoading" class="loading-state">
              <div class="loading-content">
                <mat-spinner diameter="40"></mat-spinner>
                <p>{{ 'ADMIN_DASHBOARD.LOADING_EVENTS' | translate }}</p>
              </div>
            </div>

            <!-- Error State -->
            <div *ngIf="eventsError" class="error-state">
              <div class="error-content">
                <mat-icon>error_outline</mat-icon>
                <p>{{ eventsError }}</p>
              </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="!eventsLoading && !eventsError && events.length === 0" class="empty-state">
              <div class="empty-content">
                <mat-icon>event</mat-icon>
                <h3>{{ 'ADMIN_DASHBOARD.NO_EVENTS_FOUND' | translate }}</h3>
                <p>{{ 'ADMIN_DASHBOARD.NO_EVENTS_FOUND_DESC' | translate }}</p>
              </div>
            </div>

            <!-- Events List -->
            <div *ngIf="!eventsLoading && !eventsError && events.length > 0" class="events-grid admin-grid">
              <div *ngFor="let event of events" class="event-card admin-card">
                <div class="card-header">
                  <h3>{{ event.localizedTitle }}</h3>
                  <div class="card-badge event">{{ 'ADMIN_DASHBOARD.EVENT' | translate }}</div>
                </div>
                <div class="card-body">
                  <div class="event-meta meta-grid">
                    <div class="meta-item">
                      <mat-icon>schedule</mat-icon>
                      <span>{{ event.eventDate | date:'medium' }}</span>
                    </div>
                    <div class="meta-item">
                      <mat-icon>mosque</mat-icon>
                      <span>{{ event.masjidName || ('FORM.GENERAL_EVENT' | translate) }}</span>
                    </div>
                    <div class="meta-item">
                      <mat-icon>person</mat-icon>
                      <span>{{ event.createdByName }}</span>
                    </div>
                    <div class="meta-item">
                      <mat-icon>how_to_reg</mat-icon>
                      <span>{{ event.isUserRegistered ? ('ADMIN_DASHBOARD.REGISTERED' | translate) :
                        ('ADMIN_DASHBOARD.NOT_REGISTERED' | translate) }}</span>
                    </div>
                  </div>
                  <div class="event-content content-text">
                    <p>{{ event.localizedDescription | slice:0:150 }}{{ (event.localizedDescription.length || 0) > 150
                      ? '...' : '' }}</p>
                  </div>
                </div>
                <div class="card-actions">
                  <button mat-raised-button color="primary" class="btn-edit" (click)="openEditEventForm(event)">
                    <mat-icon>edit</mat-icon>
                    {{ 'ADMIN_DASHBOARD.EDIT' | translate }}
                  </button>
                  <button mat-raised-button color="warn" class="btn-delete" (click)="deleteEvent(event)">
                    <mat-icon>delete</mat-icon>
                    {{ 'ADMIN_DASHBOARD.DELETE' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Communities Tab -->
        <div *ngIf="i === 4" class="tab-content">
          <div class="content-header">
            <div class="header-info">
              <h2>{{ 'ADMIN_DASHBOARD.COMMUNITIES_HEADER' | translate }}</h2>
              <p>{{ 'ADMIN_DASHBOARD.COMMUNITIES_DESC' | translate }}</p>
            </div>
            <div class="header-actions">
              <button mat-raised-button color="primary" class="btn-create" (click)="openCreateCommunityForm()">
                <mat-icon>add</mat-icon>
                {{ 'ADMIN_DASHBOARD.CREATE_COMMUNITY' | translate }}
              </button>
            </div>
          </div>

          <!-- Create/Edit Community Form -->
          <div *ngIf="showCreateCommunityForm || showEditCommunityForm" class="form-container">
            <div class="form-card">
              <div class="form-header">
                <h3>{{ showCreateCommunityForm ? ('ADMIN_DASHBOARD.CREATE_COMMUNITY' | translate) :
                  ('ADMIN_DASHBOARD.EDIT_COMMUNITY' | translate) }}</h3>
                <button mat-icon-button class="btn-close" (click)="cancelCommunityForm()">
                  <mat-icon>close</mat-icon>
                </button>
              </div>

              <form [formGroup]="communityForm" (ngSubmit)="onSubmitCommunity()" class="community-form form-content">
                <div class="form-grid">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'ADMIN_DASHBOARD.COMMUNITY_MASJID_LABEL' | translate }}</mat-label>
                    <mat-select formControlName="masjidId" [disabled]="masjidsLoading">
                      <mat-option *ngIf="masjidsLoading" disabled>
                        <mat-spinner diameter="20"></mat-spinner> {{ 'ADMIN_DASHBOARD.LOADING_MASJIDS' | translate }}
                      </mat-option>
                      <mat-option *ngFor="let masjid of masjids" [value]="masjid.id">
                        {{ getMasjidName(masjid) }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="communityForm.get('masjidId')?.hasError('required')">
                      {{ 'ADMIN_DASHBOARD.COMMUNITY_MASJID_REQUIRED' | translate }}
                    </mat-error>
                  </mat-form-field>

                  <!-- Multilingual Content Fields -->
                  <ng-container *ngFor="let lang of languages; let i = index">
                    <div class="language-section">
                      <h3 class="language-title">
                        <mat-icon>language</mat-icon>
                        {{ lang.name }} ({{ lang.code.toUpperCase() }})
                      </h3>
                      <!-- Title Field -->
                      <mat-form-field appearance="outline" class="full-width">
                        <mat-label>{{ 'ADMIN_DASHBOARD.COMMUNITY_TITLE_LABEL' | translate }} <span
                            class="lang-label">[{{
                            lang.code.toUpperCase() }}]</span></mat-label>
                        <input matInput [formControl]="asFormControl(communityContents.at(i).get('title'))"
                          maxlength="200">
                        <mat-hint align="end">{{ communityContents.at(i).get('title')?.value?.length || 0
                          }}/200</mat-hint>
                        <mat-error *ngIf="communityContents.at(i).get('title')?.hasError('required')">
                          {{ 'ADMIN_DASHBOARD.COMMUNITY_TITLE_REQUIRED' | translate }}
                        </mat-error>
                        <mat-error *ngIf="communityContents.at(i).get('title')?.hasError('minlength')">
                          {{ 'ADMIN_DASHBOARD.COMMUNITY_TITLE_MINLENGTH' | translate }}
                        </mat-error>
                        <mat-error *ngIf="communityContents.at(i).get('title')?.hasError('maxlength')">
                          {{ 'ADMIN_DASHBOARD.COMMUNITY_TITLE_MAXLENGTH' | translate }}
                        </mat-error>
                      </mat-form-field>
                      <!-- Content Field -->
                      <mat-form-field appearance="outline" class="full-width">
                        <mat-label>{{ 'ADMIN_DASHBOARD.COMMUNITY_CONTENT_LABEL' | translate }} <span
                            class="lang-label">[{{
                            lang.code.toUpperCase() }}]</span></mat-label>
                        <textarea matInput [formControl]="asFormControl(communityContents.at(i).get('content'))"
                          rows="4" maxlength="2000"></textarea>
                        <mat-hint align="end">{{ communityContents.at(i).get('content')?.value?.length || 0
                          }}/2000</mat-hint>
                        <mat-error *ngIf="communityContents.at(i).get('content')?.hasError('required')">
                          {{ 'ADMIN_DASHBOARD.COMMUNITY_CONTENT_REQUIRED' | translate }}
                        </mat-error>
                        <mat-error *ngIf="communityContents.at(i).get('content')?.hasError('minlength')">
                          {{ 'ADMIN_DASHBOARD.COMMUNITY_CONTENT_MINLENGTH' | translate }}
                        </mat-error>
                        <mat-error *ngIf="communityContents.at(i).get('content')?.hasError('maxlength')">
                          {{ 'ADMIN_DASHBOARD.COMMUNITY_CONTENT_MAXLENGTH' | translate }}
                        </mat-error>
                      </mat-form-field>
                    </div>
                  </ng-container>
                </div>

                <div class="form-actions">
                  <button type="button" mat-button class="btn-cancel" (click)="cancelCommunityForm()">{{
                    'ADMIN_DASHBOARD.CANCEL' | translate }}</button>
                  <button type="submit" mat-raised-button color="primary" class="btn-submit"
                    [disabled]="!communityForm.valid || isSubmitting">
                    <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
                    {{ showCreateCommunityForm ? ('ADMIN_DASHBOARD.CREATE_COMMUNITY' | translate) :
                    ('ADMIN_DASHBOARD.UPDATE_COMMUNITY' | translate) }}
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Communities List -->
          <div *ngIf="!showCreateCommunityForm && !showEditCommunityForm">
            <!-- Loading State -->
            <div *ngIf="communitiesLoading" class="loading-state">
              <div class="loading-content">
                <mat-spinner diameter="40"></mat-spinner>
                <p>{{ 'ADMIN_DASHBOARD.LOADING_COMMUNITIES' | translate }}</p>
              </div>
            </div>

            <!-- Error State -->
            <div *ngIf="communitiesError" class="error-state">
              <div class="error-content">
                <mat-icon>error_outline</mat-icon>
                <p>{{ communitiesError }}</p>
              </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="!communitiesLoading && !communitiesError && communities.length === 0" class="empty-state">
              <div class="empty-content">
                <mat-icon>group</mat-icon>
                <h3>{{ 'ADMIN_DASHBOARD.NO_COMMUNITIES_FOUND' | translate }}</h3>
                <p>{{ 'ADMIN_DASHBOARD.NO_COMMUNITIES_FOUND_DESC' | translate }}</p>
              </div>
            </div>

            <!-- Communities List -->
            <div *ngIf="!communitiesLoading && !communitiesError && communities.length > 0"
              class="communities-grid admin-grid">
              <div *ngFor="let community of communities" class="community-card admin-card">
                <div class="card-header">
                  <h3>{{ community.title }}</h3>
                  <div class="card-badge community">{{ 'ADMIN_DASHBOARD.COMMUNITY' | translate }}</div>
                </div>
                <div class="card-body">
                  <div class="community-meta meta-grid">
                    <div class="meta-item">
                      <mat-icon>mosque</mat-icon>
                      <span>{{ community.masjidName }}</span>
                    </div>
                    <div class="meta-item">
                      <span class="flag">{{ getLanguageFlag(getCommunityLanguageCode(community)) }}</span>
                      <span class="code">{{ getCommunityLanguageCode(community).toUpperCase() }}</span>
                    </div>
                    <div class="meta-item">
                      <mat-icon>person</mat-icon>
                      <span>{{ community.createdByName }}</span>
                    </div>
                    <div class="meta-item">
                      <mat-icon>group</mat-icon>
                      <span>{{ community.memberCount || 0 }} {{ 'ADMIN_DASHBOARD.MEMBERS' | translate }}</span>
                    </div>
                    <div class="meta-item">
                      <mat-icon>schedule</mat-icon>
                      <span>{{ community.dateCreated | date:'mediumDate' }}</span>
                    </div>
                  </div>
                  <div class="community-content content-text">
                    <p>{{ community.content | slice:0:150 }}{{ community.content.length > 150 ? '...' : '' }}</p>
                  </div>
                </div>
                <div class="card-actions">
                  <button mat-raised-button color="primary" class="btn-edit" (click)="openEditCommunityForm(community)">
                    <mat-icon>edit</mat-icon>
                    {{ 'ADMIN_DASHBOARD.EDIT' | translate }}
                  </button>
                  <button mat-raised-button color="warn" class="btn-delete" (click)="deleteCommunity(community)">
                    <mat-icon>delete</mat-icon>
                    {{ 'ADMIN_DASHBOARD.DELETE' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </mat-tab>
    </mat-tab-group>
  </div>